<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinTales - Financial Story Simulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .month-indicator {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 50px;
            color: white;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .stats-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2c3e50;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .story-panel {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .story-content {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .investment-results {
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 5px solid #28a745;
        }

        .result-positive {
            border-left-color: #28a745;
            background: linear-gradient(45deg, #d4edda, #c3e6cb);
        }

        .result-negative {
            border-left-color: #dc3545;
            background: linear-gradient(45deg, #f8d7da, #f5c6cb);
        }

        .result-neutral {
            border-left-color: #ffc107;
            background: linear-gradient(45deg, #fff3cd, #ffeaa7);
        }

        .choices-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 25px;
        }

        .choice-btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .choice-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .choice-btn.spending {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .choice-btn.saving {
            background: linear-gradient(45deg, #27ae60, #229954);
        }

        .choice-btn.investing {
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
        }

        .choice-btn.emergency {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }

        .choice-description {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: 8px;
        }

        .progress-section {
            background: rgba(255, 255, 255, 0.9);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 25px;
            background: #ecf0f1;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            transition: width 1s ease;
            border-radius: 15px;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.3) 50%, transparent 70%);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(200%); }
        }

        .timeline {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .timeline-item {
            text-align: center;
            flex: 1;
            position: relative;
        }

        .timeline-item.active {
            color: #3498db;
            font-weight: bold;
        }

        .timeline-item.completed {
            color: #27ae60;
        }

        .timeline-item::after {
            content: '';
            position: absolute;
            top: 50%;
            right: -50%;
            width: 100%;
            height: 2px;
            background: #bdc3c7;
            z-index: -1;
        }

        .timeline-item:last-child::after {
            display: none;
        }

        .timeline-item.completed::after {
            background: #27ae60;
        }

        .floating-animation {
            position: fixed;
            pointer-events: none;
            z-index: 1000;
            font-size: 1.5rem;
            font-weight: bold;
            animation: floatUp 2s ease-out forwards;
        }

        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(1.2);
            }
        }

        .game-over {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .game-over-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .final-score {
            font-size: 3rem;
            color: #3498db;
            margin: 20px 0;
        }

        .score-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .score-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
        }

        .improvements {
            text-align: left;
            background: #e8f4f8;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .restart-btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .restart-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .market-indicator {
            display: flex;
            justify-content: space-around;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .market-item {
            text-align: center;
            flex: 1;
        }

        .market-trend {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .trend-positive { color: #27ae60; }
        .trend-negative { color: #e74c3c; }
        .trend-neutral { color: #f39c12; }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>💰 FinTales</h1>
            <p>Your Financial Story Begins</p>
        </div>

        <div class="month-indicator" id="monthIndicator">
            Month 1 - Starting Journey
        </div>

        <div class="timeline" id="timeline">
            <div class="timeline-item active">Month 1</div>
            <div class="timeline-item">Month 3</div>
            <div class="timeline-item">Month 6</div>
            <div class="timeline-item">Month 9</div>
            <div class="timeline-item">Month 12</div>
        </div>

        <div class="stats-dashboard">
            <div class="stat-card">
                <div class="stat-icon">💰</div>
                <div class="stat-value" id="totalWealth">₹30,000</div>
                <div class="stat-label">Total Wealth</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">🏦</div>
                <div class="stat-value" id="savings">₹0</div>
                <div class="stat-label">Savings</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">📈</div>
                <div class="stat-value" id="investments">₹0</div>
                <div class="stat-label">Investments</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">💳</div>
                <div class="stat-value" id="expenses">₹0</div>
                <div class="stat-label">Monthly Expenses</div>
            </div>
        </div>

        <div class="market-indicator" id="marketIndicator">
            <div class="market-item">
                <div class="market-trend trend-positive">📈</div>
                <div>Stock Market</div>
                <div id="stockTrend">+2.5%</div>
            </div>
            <div class="market-item">
                <div class="market-trend trend-neutral">💰</div>
                <div>Fixed Deposit</div>
                <div id="fdRate">7.5%</div>
            </div>
            <div class="market-item">
                <div class="market-trend trend-positive">🏠</div>
                <div>Real Estate</div>
                <div id="realEstateTrend">+1.8%</div>
            </div>
        </div>

        <div class="progress-section">
            <h3>Financial Goals Progress</h3>
            <div>Emergency Fund (₹50,000)</div>
            <div class="progress-bar">
                <div class="progress-fill" id="emergencyProgress" style="width: 0%;"></div>
            </div>
            <div>Investment Portfolio (₹1,00,000)</div>
            <div class="progress-bar">
                <div class="progress-fill" id="investmentProgress" style="width: 0%;"></div>
            </div>
        </div>

        <div class="story-panel" id="storyPanel">
            <div class="story-content" id="storyContent">
                🎉 Welcome to your financial journey! You're a 25-year-old professional who just received your first salary of ₹30,000. 
                This is where your financial story begins. Every decision you make will shape your financial future. 
                
                <div class="investment-results result-neutral">
                    💡 <strong>Starting Point:</strong> You have ₹30,000 in hand. Choose wisely how to allocate your money for the first month.
                </div>
            </div>
            
            <div class="choices-container" id="choicesContainer">
                <!-- Choices will be dynamically generated here -->
            </div>
        </div>
    </div>

    <div class="game-over" id="gameOver" style="display: none;">
        <div class="game-over-content">
            <h2>🎯 Your Financial Journey Complete!</h2>
            <div class="final-score" id="finalScore">0</div>
            
            <div class="score-breakdown" id="scoreBreakdown">
                <!-- Score breakdown will be generated here -->
            </div>
            
            <div class="improvements" id="improvements">
                <!-- Improvement suggestions will be generated here -->
            </div>
            
            <button class="restart-btn" onclick="restartGame()">Start New Journey</button>
        </div>
    </div>

    <script>
        class FinancialStoryGame {
            constructor() {
                this.currentMonth = 1;
                this.totalWealth = 30000;
                this.savings = 0;
                this.investments = 0;
                this.monthlyExpenses = 0;
                this.investmentReturns = 0;
                this.emergencyFund = 0;
                this.score = 0;
                this.decisions = [];
                this.marketConditions = {
                    stock: 0.025,
                    fd: 0.075,
                    realEstate: 0.018
                };
                
                this.scenarios = [
                    {
                        month: 1,
                        title: "First Salary - Setting Foundation",
                        content: "You've received your first salary of ₹30,000! This is a crucial moment to set up your financial foundation.",
                        choices: [
                            {
                                text: "Save 50% (₹15,000) for emergency fund",
                                description: "Build a strong safety net first",
                                type: "saving",
                                effect: { savings: 15000, expenses: 15000, score: 25 }
                            },
                            {
                                text: "Invest 40% (₹12,000) in mutual funds",
                                description: "Start investing early for compound growth",
                                type: "investing",
                                effect: { investments: 12000, expenses: 18000, score: 20 }
                            },
                            {
                                text: "Spend on lifestyle (₹20,000)",
                                description: "Enjoy your first salary celebration",
                                type: "spending",
                                effect: { expenses: 30000, score: -10 }
                            },
                            {
                                text: "Balanced approach (₹10K save, ₹10K invest)",
                                description: "Mix of saving and investing",
                                type: "saving",
                                effect: { savings: 10000, investments: 10000, expenses: 10000, score: 30 }
                            }
                        ]
                    },
                    {
                        month: 3,
                        title: "Quarterly Review - Building Momentum",
                        content: "Three months in! You've learned some lessons. Time to adjust your strategy.",
                        choices: [
                            {
                                text: "Increase SIP by ₹5,000",
                                description: "Boost your investment contributions",
                                type: "investing",
                                effect: { investments: 15000, expenses: 15000, score: 20 }
                            },
                            {
                                text: "Build emergency fund to ₹25,000",
                                description: "Strengthen your financial safety net",
                                type: "saving",
                                effect: { savings: 10000, expenses: 20000, score: 25 }
                            },
                            {
                                text: "Take a vacation (₹15,000)",
                                description: "You deserve a break after hard work",
                                type: "spending",
                                effect: { expenses: 30000, score: -5 }
                            },
                            {
                                text: "Start a side business (₹8,000 investment)",
                                description: "Create additional income stream",
                                type: "investing",
                                effect: { investments: 8000, expenses: 22000, score: 35 }
                            }
                        ]
                    },
                    {
                        month: 6,
                        title: "Mid-Year Assessment - Major Decision",
                        content: "Six months of financial discipline! A major opportunity presents itself.",
                        choices: [
                            {
                                text: "Buy a vehicle (₹2,00,000 loan)",
                                description: "Improve mobility but take on debt",
                                type: "spending",
                                effect: { expenses: 35000, score: -15 }
                            },
                            {
                                text: "Invest in real estate (₹50,000 down payment)",
                                description: "Get into property investment",
                                type: "investing",
                                effect: { investments: 50000, score: 40 }
                            },
                            {
                                text: "Continue current strategy",
                                description: "Stay the course with current plan",
                                type: "saving",
                                effect: { savings: 15000, investments: 15000, score: 20 }
                            },
                            {
                                text: "Take professional course (₹25,000)",
                                description: "Invest in skill development",
                                type: "investing",
                                effect: { expenses: 25000, score: 30 }
                            }
                        ]
                    },
                    {
                        month: 9,
                        title: "Market Volatility - Testing Time",
                        content: "The market is experiencing volatility. Your investments are affected. How do you respond?",
                        choices: [
                            {
                                text: "Panic sell all investments",
                                description: "Secure what's left immediately",
                                type: "spending",
                                effect: { investments: -20000, savings: 15000, score: -25 }
                            },
                            {
                                text: "Buy more during the dip",
                                description: "Opportunity to buy low",
                                type: "investing",
                                effect: { investments: 20000, score: 45 }
                            },
                            {
                                text: "Hold current positions",
                                description: "Stay calm and stick to plan",
                                type: "saving",
                                effect: { score: 15 }
                            },
                            {
                                text: "Diversify into gold/FD",
                                description: "Move to safer investments",
                                type: "saving",
                                effect: { savings: 10000, investments: 5000, score: 10 }
                            }
                        ]
                    },
                    {
                        month: 12,
                        title: "Year-End Review - Final Decisions",
                        content: "Congratulations! You've completed your first year of financial journey. Time for final decisions.",
                        choices: [
                            {
                                text: "Tax planning (₹30,000 ELSS)",
                                description: "Save taxes and invest simultaneously",
                                type: "investing",
                                effect: { investments: 30000, score: 35 }
                            },
                            {
                                text: "Increase emergency fund to ₹1,00,000",
                                description: "Ultimate financial security",
                                type: "saving",
                                effect: { savings: 30000, score: 25 }
                            },
                            {
                                text: "Splurge on luxury items",
                                description: "Reward yourself for the year",
                                type: "spending",
                                effect: { expenses: 50000, score: -20 }
                            },
                            {
                                text: "Plan for next year goals",
                                description: "Set ambitious targets for year 2",
                                type: "saving",
                                effect: { savings: 10000, investments: 15000, score: 40 }
                            }
                        ]
                    }
                ];
                
                this.init();
            }
            
            init() {
                this.updateMarketConditions();
                this.showCurrentScenario();
                this.updateUI();
            }
            
            updateMarketConditions() {
                // Simulate market fluctuations
                this.marketConditions.stock = 0.02 + (Math.random() * 0.06 - 0.03);
                this.marketConditions.fd = 0.07 + (Math.random() * 0.01);
                this.marketConditions.realEstate = 0.015 + (Math.random() * 0.01);
                
                document.getElementById('stockTrend').textContent = 
                    (this.marketConditions.stock > 0 ? '+' : '') + 
                    (this.marketConditions.stock * 100).toFixed(1) + '%';
                document.getElementById('fdRate').textContent = 
                    (this.marketConditions.fd * 100).toFixed(1) + '%';
                document.getElementById('realEstateTrend').textContent = 
                    (this.marketConditions.realEstate > 0 ? '+' : '') + 
                    (this.marketConditions.realEstate * 100).toFixed(1) + '%';
            }
            
            showCurrentScenario() {
                const scenario = this.scenarios.find(s => s.month === this.currentMonth);
                if (!scenario) {
                    this.endGame();
                    return;
                }
                
                document.getElementById('monthIndicator').textContent = 
                    `Month ${this.currentMonth} - ${scenario.title}`;
                    
                document.getElementById('storyContent').innerHTML = `
                    ${scenario.content}
                    ${this.getInvestmentResults()}
                `;
                
                this.createChoices(scenario.choices);
                this.updateTimeline();
            }
            
            getInvestmentResults() {
                if (this.currentMonth === 1) return '';
                
                const returns = this.calculateInvestmentReturns();
                const resultClass = returns > 0 ? 'result-positive' : returns < 0 ? 'result-negative' : 'result-neutral';
                
                return `
                    <div class="investment-results ${resultClass}">
                        📊 <strong>Investment Update:</strong> Your investments ${returns > 0 ? 'gained' : returns < 0 ? 'lost' : 'remained stable'} 
                        ₹${Math.abs(returns).toLocaleString()} this quarter. 
                        Current portfolio value: ₹${this.investments.toLocaleString()}
                    </div>
                `;
            }
            
            calculateInvestmentReturns() {
                const monthsMultiplier = this.currentMonth === 3 ? 3 : this.currentMonth === 6 ? 3 : this.currentMonth === 9 ? 3 : 3;
                const returns = this.investments * this.marketConditions.stock * (monthsMultiplier / 12);
                this.investments += Math.round(returns);
                this.totalWealth += Math.round(returns);
                return Math.round(returns);
            }
            
            createChoices(choices) {
                const container = document.getElementById('choicesContainer');
                container.innerHTML = '';
                
                choices.forEach((choice, index) => {
                    const button = document.createElement('button');
                    button.className = `choice-btn ${choice.type}`;
                    button.innerHTML = `
                        <div>${choice.text}</div>
                        <div class="choice-description">${choice.description}</div>
                    `;
                    
                    button.onclick = () => this.makeChoice(choice, button);
                    container.appendChild(button);
                });
            }
            
            makeChoice(choice, buttonElement) {
                // Add visual feedback
                buttonElement.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    buttonElement.style.transform = 'scale(1)';
                }, 150);
                
                // Apply choice effects
                this.applyChoiceEffects(choice);
                
                // Store decision for final analysis
                this.decisions.push({
                    month: this.currentMonth,
                    choice: choice.text,
                    type: choice.type,
                    score: choice.effect.score
                });
                
                // Show floating animation
                this.showFloatingFeedback(choice.effect, buttonElement);
                
                // Move to next scenario
                setTimeout(() => {
                    this.nextScenario();
                }, 2000);
            }
            
            applyChoiceEffects(choice) {
                const effect = choice.effect;
                
                if (effect.savings) {
                    this.savings += effect.savings;
                    this.totalWealth -= effect.savings; // Money moved from total to savings
                }
                
                if (effect.investments) {
                    this.investments += effect.investments;
                    this.totalWealth -= effect.investments; // Money moved from total to investments
                }
                
                if (effect.expenses) {
                    this.monthlyExpenses = effect.expenses;
                    this.totalWealth -= effect.expenses; // Money spent
                }
                
                this.score += effect.score;
                
                // Add monthly salary
                this.totalWealth += 30000;
                
                this.updateUI();
            }
            
            showFloatingFeedback(effect, element) {
                const rect = element.getBoundingClientRect();
                
                Object.keys(effect).forEach((key, index) => {
                    if (effect[key] !== 0) {
                        const floatingDiv = document.createElement('div');
                        floatingDiv.className = 'floating-animation';
                        
                        let text = '';
                        let color = '';
                        
                        switch(key) {
                            case 'savings':
                                text = `Savings: ${effect[key] > 0 ? '+' : ''}₹${effect[key].toLocaleString()}`;
                                color = effect[key] > 0 ? '#27ae60' : '#e74c3c';
                                break;
                            case 'investments':
                                text = `Investments: ${effect[key] > 0 ? '+' : ''}₹${effect[key].toLocaleString()}`;
                                color = effect[key] > 0 ? '#9b59b6' : '#e74c3c';
                                break;
                            case 'score':
                                text = `Score: ${effect[key] > 0 ? '+' : ''}${effect[key]}`;
                                color = effect[key] > 0 ? '#f39c12' : '#e74c3c';
                                break;
                        }
                        
                        floatingDiv.textContent = text;
                        floatingDiv.style.color = color;
                        floatingDiv.style.left = rect.left + (index * 50) + 'px';
                        floatingDiv.style.top = rect.top - (index * 30) + 'px';
                        
                        document.body.appendChild(floatingDiv);
                        
                        setTimeout(() => floatingDiv.remove(), 2000);
                    }
                });
            }
            
            nextScenario() {
                const nextMonths = [3, 6, 9, 12];
                const currentIndex = nextMonths.findIndex(m => m > this.currentMonth);
                
                if (currentIndex === -1) {
                    this.endGame();
                    return;
                }
                
                this.currentMonth = nextMonths[currentIndex];
                this.updateMarketConditions();
                this.showCurrentScenario();
            }
            
            updateUI() {
                document.getElementById('totalWealth').textContent = `₹${this.totalWealth.toLocaleString()}`;
                document.getElementById('savings').textContent = `₹${this.savings.toLocaleString()}`;
                document.getElementById('investments').textContent = `₹${this.investments.toLocaleString()}`;
                document.getElementById('expenses').textContent = `₹${this.monthlyExpenses.toLocaleString()}`;
                
                // Update progress bars
                const emergencyProgress = Math.min(100, (this.savings / 50000) * 100);
                const investmentProgress = Math.min(100, (this.investments / 100000) * 100);
                
                document.getElementById('emergencyProgress').style.width = emergencyProgress + '%';
                document.getElementById('investmentProgress').style.width = investmentProgress + '%';
            }
            
            updateTimeline() {
                const timelineItems = document.querySelectorAll('.timeline-item');
                const monthsMap = [1, 3, 6, 9, 12];
                
                timelineItems.forEach((item, index) => {
                    item.classList.remove('active', 'completed');
                    
                    if (monthsMap[index] < this.currentMonth) {
                        item.classList.add('completed');
                    } else if (monthsMap[index] === this.currentMonth) {
                        item.classList.add('active');
                    }
                });
            }
            
            endGame() {
                const finalWealth = this.totalWealth + this.savings + this.investments;
                const gameOverDiv = document.getElementById('gameOver');
                const finalScoreDiv = document.getElementById('finalScore');
                const scoreBreakdownDiv = document.getElementById('scoreBreakdown');
                const improvementsDiv = document.getElementById('improvements');
                
                // Calculate final score
                let finalScore = this.score;
                finalScore += Math.floor(this.savings / 1000); // Bonus for savings
                finalScore += Math.floor(this.investments / 500); // Bonus for investments
                finalScore += Math.floor(finalWealth / 1000); // Bonus for total wealth
                
                finalScoreDiv.textContent = finalScore;
                
                // Score breakdown
                scoreBreakdownDiv.innerHTML = `
                    <div class="score-item">
                        <div><strong>Decision Score</strong></div>
                        <div>${this.score}</div>
                    </div>
                    <div class="score-item">
                        <div><strong>Final Wealth</strong></div>
                        <div>₹${finalWealth.toLocaleString()}</div>
                    </div>
                    <div class="score-item">
                        <div><strong>Emergency Fund</strong></div>
                        <div>₹${this.savings.toLocaleString()}</div>
                    </div>
                    <div class="score-item">
                        <div><strong>Investments</strong></div>
                        <div>₹${this.investments.toLocaleString()}</div>
                    </div>
                `;
                
                // Generate improvements
                const improvements = this.generateImprovements(finalWealth);
                improvementsDiv.innerHTML = `
                    <h3>💡 How to Improve Your Financial Journey:</h3>
                    <ul>
                        ${improvements.map(imp => `<li>${imp}</li>`).join('')}
                    </ul>
                `;
                
                gameOverDiv.style.display = 'flex';
            }
            
            generateImprovements(finalWealth) {
                const improvements = [];
                
                if (this.savings < 25000) {
                    improvements.push("🏦 Build a stronger emergency fund - aim for at least 6 months of expenses (₹50,000)");
                }
                
                if (this.investments < 50000) {
                    improvements.push("📈 Increase your investment allocation - start early to benefit from compound growth");
                }
                
                if (finalWealth < 200000) {
                    improvements.push("💰 Focus on increasing your overall wealth - consider additional income sources or higher-return investments");
                }
                
                const spendingDecisions = this.decisions.filter(d => d.type === 'spending').length;
                if (spendingDecisions > 2) {
                    improvements.push("🛑 Reduce lifestyle inflation - be more mindful of unnecessary expenses");
                }
                
                const investmentDecisions = this.decisions.filter(d => d.type === 'investing').length;
                if (investmentDecisions < 2) {
                    improvements.push("🚀 Be more aggressive with investments when young - time is your biggest advantage");
                }
                
                if (this.score < 50) {
                    improvements.push("📚 Learn more about personal finance - knowledge leads to better decision-making");
                }
                
                improvements.push("🎯 Set specific financial goals with deadlines for better motivation and tracking");
                improvements.push("📊 Review and rebalance your portfolio regularly based on market conditions");
                
                return improvements;
            }
        }
        
        // Initialize game
        let game;
        window.addEventListener('load', () => {
            game = new FinancialStoryGame();
        });
        
        function restartGame() {
            location.reload();
        }
        
        // Function to integrate with chatbot responses
        function updateGameFromChatbot(response) {
            if (!game) return;
            
            // Update game based on chatbot analysis
            if (response.userProfile) {
                const profile = response.userProfile;
                
                if (profile.income) {
                    // Adjust scenarios based on income level
                    game.scenarios.forEach(scenario => {
                        scenario.choices.forEach(choice => {
                            // Scale amounts based on income
                            const scaleFactor = profile.income / 30000;
                            if (choice.effect.savings) {
                                choice.effect.savings = Math.round(choice.effect.savings * scaleFactor);
                            }
                            if (choice.effect.investments) {
                                choice.effect.investments = Math.round(choice.effect.investments * scaleFactor);
                            }
                            if (choice.effect.expenses) {
                                choice.effect.expenses = Math.round(choice.effect.expenses * scaleFactor);
                            }
                        });
                    });
                }
                
                if (profile.goal) {
                    // Update progress tracking based on user's actual goal
                    document.querySelector('.progress-section h3').textContent = `${profile.goal} Progress`;
                }
                
                if (profile.riskProfile) {
                    // Adjust market conditions based on risk profile
                    if (profile.riskProfile === 'conservative') {
                        game.marketConditions.stock *= 0.7;
                        game.marketConditions.fd *= 1.1;
                    } else if (profile.riskProfile === 'aggressive') {
                        game.marketConditions.stock *= 1.3;
                    }
                }
            }
            
            // Add custom scenarios from chatbot
            if (response.customScenarios) {
                game.scenarios = [...game.scenarios, ...response.customScenarios];
            }
            
            // Update current scenario text
            if (response.contextualAdvice) {
                const storyContent = document.getElementById('storyContent');
                storyContent.innerHTML += `
                    <div class="investment-results result-neutral">
                        🤖 <strong>AI Advisor:</strong> ${response.contextualAdvice}
                    </div>
                `;
            }
        }
        
        // Sample integration call - this would be called by your Watson chatbot
        // updateGameFromChatbot({
        //     userProfile: {
        //         income: 45000,
        //         goal: "House Down Payment",
        //         riskProfile: "moderate"
        //     },
        //     contextualAdvice: "Based on your query about saving for a laptop, consider the 50-30-20 rule for better financial balance."
        // });
    </script>
</body>
</html>